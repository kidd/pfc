\documentclass[titlepage,a4paper,12pt]{book}

\usepackage[utf8]{inputenc}
\usepackage[catalan]{babel}
\usepackage{graphicx}
\usepackage{marvosym}
\usepackage{amssymb, amsmath} 

\begin{document}
\section{Objectius} % (fold)
\label{sec:Objectius}
Aquest projecte anomenat \texttt{Pholus}, ha estat desenvolupat per a equilibrar (ponderar) pesos dels
diferents maps, per a veure quins són més rellevants a l'hora de 'enganxar' amb el receptor.  %XXX enganxar

Es tracta d'un algoritme evolutiu relativament senzill pel que fa al propi algoritme, però més
complex pel referent a les condicions externes que s'imposen per la natura, i que ens obliguen a
posar condicions i limitacions al Algoritme Evolutiu (als Algoritmes Evolutius no els agraden les 
limitacions).

Com es mostrarà en les següents seccions, hi ha una part important de feina
realitzada en la preparació de les dades, i en la corresponent validació dels
resultats.


% section Objectius (end)

\section{Context Químic} % (fold)
\label{sec:Context Quimic}
Tanimotos, conformacions, y tal 

El problema al que ens enfrontem és el de, donat un \texttt{receptor} i un conjunt de %glossari
\texttt{lligands}, deduir quins són els factors que fan que la unió sigui millor
o pitjor.  Els factors que intervenen en aquesta unió són molts, però a nivell
pràctic, utilitzem ``nomes'' 22 indicadors, que són els que podem quantificar
amb facilitat, i que hem cregut que tenen més rellevància en aquest procés.

Aquests indicadors són:

%\begin{list}{Indicadors}{}
%\item Pes molecular
%\item potencial electroestàtic
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\item 
%\end{list}

\begin{table}
\centering
\begin{tabular}{|ccc|}
\hline
aromatic carbon &aliphatic carbon&non-hydrogen bonding sulfur\\
non-hydrogen bonding phosphor&phosphor&non-hydrogen bonding nitrogen\\
hydrogen donor&oxygen acceptor&nitrogen acceptor\\
sulfur acceptor&spherical nitrogen acceptor&spherical oxygen acceptor\\
fluorine&chlorine&bromine\\
iodine&iron&manganese\\
calcium&magnesium&zinc\\
positive charge&& \\
\hline
\end{tabular}
\caption{The 22 atom probes implemented in HELIOS.}
\label{table:maps}
\end{table}

Per tal que una unió entre lligand i receptor sigui bona, les energies
dissipades s'han de minimitzar, mostrant així que entre les dues molècules es
neutralitzen.  Si la energia és alta, fa que la estructura final (lligand +
receptor) sigui poc estable i fàcilment trencada, ja que les dues parts, poden
trobar alguna altra formació on ``es troben més còmodes''.

Tanimotos. Què cony son? %XXX

\subsubsection{Estereoisomers i conformacions}\label{ssub:estereoisomers i conformacions}

Una altra particularitat del problema és la varietat de estereoisomers i de
conformacions que pot tenir una molecula donada.  Una molècula, identificada per
un nom i una composició pot tenir diverses maneres de mapejar-se en un espai
tridimensional.

Quan diem que una molècula pot tenir varis estereoisomers, ens referim a que
dues molècules, poden ser simètriques, però no superposables.  Un exemple al que
podem estar més acostumats, per entendre el concepte són les mans.  La mà dreta
i la esquerra, tindrien la mateixa composició, però al ser simètriques una
respecte la altra, fa que no puguem superposarles.

Cada estereoisomer pot tenir diverses conformacions.  Amb això ens referim a què
en la natura, no sempre trobem la molècula amb els mateixos angles entre atoms,
tipus d'enllassos, etc. Per exemple, una molècula pot trobarse en la natura
enrotllada sobre ella mateixa, o bé estirada (és bastant comú trobar aquests
tipus de conformacions).

%XXX Fotos de isomers i conformacions

Quan sabem que una molècula és activa, podem no tan sols buscar la minimització
d'energia (és una feina costosa, i no podem controlar tots els agents externs
presents en l'entorn), sinó que podem, simplement refiar-nos de que sabem
empíricament que la activitat d'un lligand amb un receptor.

%XXX quan tenim molecules actives, no tenim la conf ni isomer, i hem de buscar
%d'entre totes, la millor, i fiarnos que aquella es la bona, per comparar amb
%les que busquem


El que utilitzem és la informació de molecules que sabem que són actives,
i elaborem tot el procediment per a descobrir quines condicions compleixen entre
elles que les pot fer actives.

Així doncs, les dades que tenim com a entrada són simplement els 22 valors per a
cada molecula (isomer X conformació), i una llista de quines d'elles sabem del
cert que presenten activitat contra un receptor donat.  El que volem aconseguir
és doncs, 22 factors, pels que multiplicar els 22 \textbf{tanimotos} i que al
sumar-los, ens donin una ordenació de les molècules, situant les actives en
les primeres posicions (un index de activitat?).

% XXX Formula

Inicialment, hem provat la intuició química, per decidir quin tipus de
indicadors són els més rellevants, i ajudats amb eines estadístiques, hem
aconseguit trobar unes ponderacions que situen la majoria de molecules actives
en les primeres posicions, però el procés és manual, i no assegura ni la
ordenació actives/inactives, ni la propia ordenació de les actives al principi
de la llista (no totes les actives són ``igual'' d'actives).

% section Context Químic (end)

\section{Procediment informàtic} % (fold)
\label{sec:Procediment informatic}

Desde el punt de vista informàtic, el problema es pot descriure de la següent
manera:

Tenim una entrada de dades de un conjunt de molècules (amb un identificador
únic) amb els seus 22 valors associats a cadascun dels maps escollits, i una
llista amb les molècules actives (els ids).

Utilitzem un algoritme evolutiu, per trobar els 22 valors als que multiplicar
cadascun dels maps, que fan que obtinguem una ordenació de les molècules que
classifica les actives al principi.

% subsubsection subsubsection name (end)
% section inf (end)
\subsection{preparació de dades} % (fold)
\label{sub:preparacio de dades}
Una molècula es pot trobar en la natura en diverses formes.  Les clasificacions es divideixen en
isomers i conformacions.  Una molècula pot tenir diversos isomers, i cada isomer es pot trobar en  
diverses conformacions.

És a dir, que per un nom (o id), en la natura deriven diverses estructures, que comparteixen nom, i
elements, però poden estar organitzats de forma diferent en l'espai. Aquestes organitzacions son
simètriques en l'espai 3D, donant lloc a molècules similars, però que en l'espai 3D, no es superposen de la
mateixa forma. (exemple, les mans, que no es poden superposar en 3D).

Les conformacions, en canvi, són variacions de la posició dels àtoms en l'espai, però mantenint els
enllaços entre àtoms.

Per passar d'un estereoisomer a un altre, s'han de trencar enllaços, i tornar-se a formar.  En les
conformacions no passa això, i es pot passar d'una a una altra, només canviant els angles dels
enllaços i la seva flexibilitat. 

Donat un conjunt de molècules que volem utilitzar, hem de saber quina de les conformacions triarem
per a cada molècula.  Per a fer la \texttt{explosió} de combinacions, s'utilitza un sofware
especific, que fa la combinatoria i genera les possibles variacions sobre una molècula donada. 

\subsubsection{Procés de preparació} % (fold)
\label{ssub:Proces de preparacio}

Amb un conjunt de molècules, l'hi hem de trobar tots els isomers i les conformacions diferents en
les que es poden trobar a la natura, és per això que primer, donada una base de dades de molècules
diferents, hem de generar totes les conformacions possibles de cada molècula.  Una vegada les tenim
generades, hem de quedar-nos amb la conformació que millors resultats dóna en aquest problema.  Per
fer això, tenim un seguit de programes de tractament de dades, que ens permeten prepararles d'acord
amb les nostres necessitats.
% subsubsection Procés de preparació (end)

\subsubsection{Massatgeant les dades} % (fold)
\label{ssub:Massatgeant les dades}

% subsubsection Massatgeant les dades (end)

% subsection preparació de dades (end)

\subsection{Algoritme genètic} % (fold)
\label{sub:genetic}

Els operadors usats en aquest algoritme genètic són dels més clàssics ja que
donat el problema, tan sols hi ha necessitat d'aplicar operadors ``bàsics'' als
individus.  Com s'ha explicat anteriorment, no s'ha volgut potenciar la
dependència entre els diferents gens dels individus.

Parametres

\subsubsection{Individu (Cromosoma)}
\label{ssub:individu (cromosoma)}

En aquest algoritme genètic, els individus són les ponderacions.  Cada individu
de la població és un conjunt de 22 valors de coma flotant (de doble precisió)
que es correspon a cadascun dels 22 indicadors (maps),  Donat que volem saber
quines rellevàncies tenen els indicadors, però confiem que no tenen cap relació
un amb el següent, hem decidit no utilitzar cap representació que tingui en
compte l'ordre, ni que afavoreixi la dependència dels gens. %XXX GENS?

S'han fet proves sobre acotar els valors possibles entre 0 i $Inf$, però si
permetem valors negatius, l'Algoritme evolutiu pot jugar amb fer ponderar
negativament un tipus de maps, donant més flexibilitat al Algoritme evolutiu per
trobar una bona ponderació.  Si el mínim valor que pogués asignar fós 0,
simplement eliminaria un map si no té cap rellevància però d'aquesta manera li
permetem penalitzar un indicador.

Donar de marge de $-Inf$ a $Inf$, era problemàtic en tant que l'Algoritme
evolutiu acaba donant molta rellevància a uns quants (pocs) maps, i
comparativament molt poca a la majoria, donant poca riquesa a la ponderació i
tendint a sobreentrenar-se per al conjunt de dades que li entrem, però sense
donar resultats extrapolàbles a altres conjunts de dades.

La següent versió, va ser deixar posar valors entre [-1,1] , però tals que la
suma de tots fós 1.  Els resultats tampoc van ser concloents (a part que tampoc
tenia molt de sentit lògic més que el de acotar que tots els individus
estiguéssin dins d'uns marges).

Al final, s'ha adoptat donar de marge [-1,1], però sense límit en la suma total
dels valors.


\subsubsection{Mutacions} % (fold)
\label{ssub:Mutacions}

S'apliquen mutacions en un 0.1\% dels individus una vegada fet el creuament.
Les mutacions en aquesta aplicació consisteixen en modificar una ponderació per
una altra (al·lel).  La única restricció és que es mantingui dins dels marges
[-1,+1] .
% subsubsection Mutacions (end)

\subsubsection{Crossover} % (fold)
\label{ssub:Crossover}
Pel creuament s'ha provat un creuament per un punt, i el creuament per dos punts, donant millors
resultats el creuament en tant sols un punt.  

Donats dos individus (els que han estat sel·leccionats en el procés de
sel·lecció , amb una provabilitat d'un 0.8 es fa creuament i els fills són tan
sols una partició formada a partir dels 2 pares, amb un punt de tall aleatori.
% subsubsection crossover (end)

\subsubsection{Fitness} % (fold)
\label{ssub:Fitness}
En aquest problema, la funció que ens indica com de bò és un individu (funció
\texttt{fitness}) és el resultat de evaluar la ordenació que dóna la ponderació
indicada per l'individu, respecte els nostres coneixements de activitat. Aquesta
evaluació la fem mitjançant un dels diferents algoritmes de evaluació d'ordenacions.

%XXX : enchufar bedroc, ROC, tanimotos, i tota la merda


És així, una funció que pondera ordenacions.  Per tant, la funció té un cost
elevat per a ser cridada per cada evaluació d'un individu.  S'han utilitzat
algunes tècniques d'optimització per a evitar recalcular ponderacions ja fetes,
etc.

%XXX Explicar memoize

\begin{itemize}
	\item Roc
	\item BedRoc
	\item Enrichment Factor
	\item \dots
\end{itemize}


En qualsevol d'aquests procediments, es tracta d'evaluar com està de ben ordenada una llista, en
funció d'unes regles.

% subsubsection Fitness (end)


\subsection{sobreentrenament} % (fold)
\label{sub:sobreentrenament}

Un dels problemes que comporta la utilització d'algoritmes evolutius és
l'anomenat sobreentrenament.  El sobreentrenament és l'efecte que es dóna quan
utilitzem un conjunt de dades per entrenar un programa, i l'utilitzem tantes
vegades, que la solució obtinguda és molt bona pel conjunt de dades amb el qual
ha estat entrenat, però al aplicar la solució obtinguda en altres dades, els
resultats obtinguts són molt pitjors als esperats.

Això es pot donar per diversos motius, però un dels motius més freqüents és quan
disposem de poques dades en el nostre conjunt d'entrenament.  L'algoritme
genètic, prepara una solució ``a mida'', donant-nos molt bons resultats en les
nostres dades, perquè ``estudia'' els casos del conjunt de entrenament un a un,
creant solucions ad-hoc, no aplicables a altres conjunts de dades.

Per tenir controlat aquest sobreentrenament, s'ha aplicat una tècnica basada en
``leave one out'' on fem l'entrenament amb un percentatge determinat de les
dades, 

- Pq no es sobreentreni, conjunt de test i conj de validació.
- 80 10 10, es fa sobre molecules i despres es deixen passar totes les
conformacions d'aquestes molecules, fent que les dades finals no siguin 80 10 10
, pero aixo es correcte pq la flexibilitat d'una molecula es part de la seva
'qualitat'.

% subsection sobreentrenament (end)

% section Al (end)

\end{document}
